# Emoji Generator - 产品需求文档 (PRD)

## 文档信息
- **产品名称**: Emoji Generator（表情包生成器）
- **版本号**: v1.0
- **文档日期**: 2025-11-10
- **产品经理**:
- **参考原型**: emoji-gen.ninja

---

## 一、产品概述

### 1.1 产品定位
一款免费的在线文字转表情图片生成工具，专为聊天工具（Slack、Discord、Teams 等）用户打造，支持高度自定义的文字、颜色和样式配置。

### 1.2 目标用户
- **主要用户**: Slack/Discord/Teams 团队管理员和活跃用户
- **次要用户**: 社交媒体内容创作者、设计师
- **用户痛点**:
  - 聊天工具自带表情包不够个性化
  - 第三方工具功能复杂或收费
  - 需要快速创建简洁明了的反应表情

### 1.3 核心价值
- **5 分钟上手**: 无需学习即可快速生成
- **专业质量**: 生成适配各平台的高质量 PNG 图片
- **完全免费**: 无广告、无付费墙、无使用限制

---

## 二、功能需求

### 2.1 文字编辑模块

#### 2.1.1 文本输入框（P0 核心功能）

**功能描述**:
- 提供两个独立的文本输入框，支持用户输入 1-2 行文字

**详细规格**:
| 参数 | 说明 |
|------|------|
| 输入行数 | 2 行（第一行和第二行） |
| 字符限制 | 每行建议 2-6 个字符，最大 10 个字符 |
| 字符类型 | 支持中文、英文、数字、符号、Emoji |
| 空行处理 | 允许某一行为空 |
| 实时预览 | 输入时即时更新预览 |

**交互逻辑**:
1. 用户在"第一行"输入框输入文字
2. 用户在"第二行"输入框输入文字（可选）
3. 系统实时渲染预览图
4. 超出建议字符数时显示警告提示

**UI 元素**:
```
┌─────────────────────────────┐
│ 第一行文字                   │
│ ┌─────────────────────────┐ │
│ │ [输入框]                 │ │
│ └─────────────────────────┘ │
│                             │
│ 第二行文字（可选）           │
│ ┌─────────────────────────┐ │
│ │ [输入框]                 │ │
│ └─────────────────────────┘ │
└─────────────────────────────┘
```

**验证规则**:
- 至少输入一行文字（不能全部为空）
- 单行字符数超过 6 个时显示提示："字符过多可能影响显示效果"

---

#### 2.1.2 文字对齐方式（P0 核心功能）

**功能描述**:
用户可选择文字在画布上的水平对齐方式

**选项**:
- 🔲 左对齐 (Left)
- ☑️ 居中对齐 (Center) - 默认选中
- 🔲 右对齐 (Right)

**UI 样式**:
```
对齐方式: [◀️ 左对齐]  [⬛ 居中]  [▶️ 右对齐]
```

**行为**:
- 单选按钮组
- 点击切换，立即更新预览

---

#### 2.1.3 文字大小控制（P1 重要功能）

**功能描述**:
控制文字大小，支持自动和手动两种模式

**模式一：自动模式（推荐）**
- 系统根据文字长度自动计算最佳字号
- 规则：
  - 1-2 字符：80px
  - 3-4 字符：60px
  - 5-6 字符：45px
  - 7+ 字符：35px
- 两行文字时取较长行的字号

**模式二：手动模式**
- 用户手动调节字号
- 范围：20px - 100px
- 步进：5px

**UI 元素**:
```
文字大小:
  ☑️ 自动调整（推荐）
  🔲 手动设置 [━━●━━━━━] 60px
```

---

### 2.2 字体选择模块（P0 核心功能）

#### 2.2.1 字体下拉菜单

**功能描述**:
提供多种字体供用户选择

**字体列表**（第一版实现）:
1. **思源黑体 (Source Han Sans)** - 默认
   - 支持：中文、日文、英文
   - 适合：大部分场景
2. **Arial Bold**
   - 支持：英文、数字
   - 适合：英文标语
3. **Impact**
   - 支持：英文、数字
   - 适合：强调效果
4. **Comic Sans MS**
   - 支持：英文、数字
   - 适合：轻松风格
5. **Courier New Bold**
   - 支持：英文、数字
   - 适合：代码风格
6. **Noto Serif**
   - 支持：中文、英文
   - 适合：正式场合

**交互逻辑**:
- 下拉选择框
- 选择后立即更新预览
- 字体不支持输入字符时显示警告："当前字体不支持中文字符"

**UI 元素**:
```
字体: [思源黑体 ▼]
      ├─ 思源黑体 (推荐)
      ├─ Arial Bold
      ├─ Impact
      ├─ Comic Sans MS
      ├─ Courier New Bold
      └─ Noto Serif
```

---

### 2.3 颜色定制模块（P0 核心功能）

#### 2.3.1 前景色（文字颜色）选择器

**功能描述**:
设置文字的颜色和透明度

**输入方式**:
1. **颜色选择器**: 点击色块弹出颜色选择面板
2. **HEX 输入**: 手动输入 HEX 色值（如 #FF5733）
3. **RGB 输入**: 分别输入 R、G、B 值（0-255）
4. **透明度滑块**: 调节不透明度（0-100%）

**默认值**:
- 颜色：白色 (#FFFFFF)
- 不透明度：100%

**UI 布局**:
```
前景色（文字颜色）:
  ┌────┐  HEX: [#FFFFFF]
  │████│
  └────┘  RGB: R[255] G[255] B[255]

          不透明度: [━━━━━━━━●] 100%
```

---

#### 2.3.2 背景色选择器

**功能描述**:
设置表情图片的背景颜色或透明背景

**模式一：透明背景**
- ☑️ 勾选"透明背景"复选框
- 背景完全透明（Alpha = 0）
- 仅显示文字

**模式二：纯色背景**
- 🔲 取消勾选"透明背景"
- 显示颜色选择器（同前景色）
- 支持 HEX、RGB 输入和透明度调节

**默认值**:
- 模式：纯色背景
- 颜色：蓝色 (#3B88C3)
- 不透明度：100%

**UI 布局**:
```
背景色:
  🔲 透明背景

  ┌────┐  HEX: [#3B88C3]
  │████│
  └────┘  RGB: R[59] G[136] B[195]

          不透明度: [━━━━━━━━●] 100%
```

---

#### 2.3.3 预设配色方案（P2 扩展功能）

**功能描述**:
提供常用配色模板快速应用

**预设方案**:
| 方案名 | 前景色 | 背景色 | 场景 |
|-------|--------|--------|------|
| 经典蓝 | 白色 | 蓝色 | 默认 |
| 红色警告 | 白色 | 红色 | 警告/错误 |
| 绿色成功 | 白色 | 绿色 | 完成/成功 |
| 黄色提醒 | 黑色 | 黄色 | 提醒/注意 |
| 黑白简约 | 白色 | 黑色 | 简约风 |
| 粉色可爱 | 白色 | 粉色 | 可爱风 |
| 透明文字 | 黑色 | 透明 | 纯文字 |

**交互**:
- 点击方案卡片 → 自动应用颜色 → 更新预览

---

### 2.4 预览与生成模块（P0 核心功能）

#### 2.4.1 实时预览窗口

**功能描述**:
在页面中央显示表情的实时预览效果

**规格**:
- 预览尺寸：256x256px（实际生成 128x128px）
- 显示效果：与最终生成完全一致
- 更新时机：任何参数改变后立即更新
- 背景网格：透明背景时显示棋盘格背景

**UI 布局**:
```
┌─────────────────────────────────┐
│         实时预览                 │
│  ┌─────────────────────────┐   │
│  │                         │   │
│  │        你的文字          │   │
│  │      Custom Emoji       │   │
│  │                         │   │
│  └─────────────────────────┘   │
│         256 × 256 px            │
└─────────────────────────────────┘
```

---

#### 2.4.2 生成下载按钮

**功能描述**:
点击按钮生成 PNG 图片并下载到本地

**按钮规格**:
- 文案：**"生成并下载 PNG"**
- 样式：大号主按钮，突出显示
- 位置：预览窗口正下方居中

**生成逻辑**:
1. 用户点击按钮
2. 前端发送参数到后端 API
3. 后端使用 Skia 渲染图片
4. 返回 PNG 文件
5. 浏览器自动下载

**文件命名规则**:
- 格式：`emoji_[文字内容]_[时间戳].png`
- 示例：`emoji_完成_20251110_143022.png`
- 特殊字符替换为下划线

**API 接口**:
```
POST /api/generate
Content-Type: application/json

{
  "line1": "完成",
  "line2": "Done",
  "font": "Source Han Sans",
  "fontSize": "auto",  // 或具体数值
  "align": "center",
  "textColor": "#FFFFFF",
  "textOpacity": 100,
  "bgColor": "#3B88C3",
  "bgOpacity": 100,
  "transparent": false,
  "size": 128
}

Response: PNG 文件流
```

---

### 2.5 辅助功能模块

#### 2.5.1 重置按钮（P1 重要功能）

**功能描述**:
一键恢复所有参数到默认值

**触发位置**:
- 生成按钮旁边的次级按钮
- 文案："重置"

**行为**:
- 点击后弹出确认对话框："确定要重置所有设置吗？"
- 确认后恢复到默认参数
- 更新预览

---

#### 2.5.2 参数显示（P2 扩展功能）

**功能描述**:
在侧边栏显示当前所有参数，方便复制分享

**显示内容**:
```yaml
当前配置:
  第一行: "完成"
  第二行: "Done"
  字体: 思源黑体
  大小: 自动 (60px)
  对齐: 居中
  文字色: #FFFFFF (100%)
  背景色: #3B88C3 (100%)
```

**交互**:
- 点击"复制配置"按钮 → 复制为 JSON
- 点击"导入配置"按钮 → 粘贴 JSON 恢复参数

---

#### 2.5.3 使用说明（P1 重要功能）

**功能描述**:
在页面顶部或侧边显示简要使用指南

**内容**:
```
📝 使用指南
1. 输入 1-2 行文字（建议每行 2-4 字）
2. 选择字体和对齐方式
3. 自定义文字和背景颜色
4. 点击"生成并下载"获取 PNG 图片
5. 上传到 Slack/Discord 等聊天工具

💡 提示
- 建议使用"自动调整"字号
- 透明背景适合叠加在其他内容上
- 生成的图片尺寸为 128×128px
```

---

## 三、技术实现方案

### 3.1 前端技术栈

**推荐方案**:
- **框架**: Vue.js 3 / React 18 / 纯 JavaScript
- **UI 库**: Tailwind CSS / Bootstrap 5
- **颜色选择器**: vue-color / react-color

**文件结构**:
```
web/
├── static/
│   ├── emoji.html          # 主页面
│   ├── emoji.js            # 核心逻辑
│   └── emoji.css           # 样式
└── components/
    ├── TextInput.js        # 文本输入组件
    ├── FontSelector.js     # 字体选择组件
    ├── ColorPicker.js      # 颜色选择组件
    └── Preview.js          # 预览组件
```

---

### 3.2 后端技术栈

**推荐方案**:
- **语言**: Python 3.8+
- **框架**: FastAPI / Flask
- **图形库**: Pillow (PIL) / Skia-Python

**API 实现**:
```python
from fastapi import FastAPI
from PIL import Image, ImageDraw, ImageFont
import io

app = FastAPI()

@app.post("/api/generate")
async def generate_emoji(params: EmojiParams):
    # 1. 创建画布
    img = Image.new('RGBA', (128, 128),
                    color=parse_color(params.bgColor, params.bgOpacity))

    # 2. 加载字体
    font = ImageFont.truetype(params.font, params.fontSize)

    # 3. 绘制文字
    draw = ImageDraw.Draw(img)
    draw.text((x, y), params.line1,
              font=font, fill=parse_color(params.textColor, params.textOpacity))

    # 4. 返回 PNG
    buf = io.BytesIO()
    img.save(buf, format='PNG')
    return Response(content=buf.getvalue(), media_type="image/png")
```

---

### 3.3 核心算法

#### 3.3.1 文字自动缩放算法

```python
def calculate_font_size(text: str, canvas_width: int, canvas_height: int) -> int:
    """
    根据文字长度自动计算最佳字号
    """
    char_count = len(text)

    if char_count <= 2:
        return 80
    elif char_count <= 4:
        return 60
    elif char_count <= 6:
        return 45
    else:
        return max(35, 100 - char_count * 8)  # 动态缩小
```

#### 3.3.2 文字居中算法

```python
def calculate_text_position(text: str, font: ImageFont,
                          canvas_width: int, canvas_height: int,
                          align: str, line_number: int, total_lines: int) -> tuple:
    """
    计算文字绘制位置
    """
    bbox = font.getbbox(text)
    text_width = bbox[2] - bbox[0]
    text_height = bbox[3] - bbox[1]

    # 垂直位置（多行时均分）
    line_spacing = canvas_height / (total_lines + 1)
    y = line_spacing * (line_number + 1) - text_height / 2

    # 水平位置
    if align == 'center':
        x = (canvas_width - text_width) / 2
    elif align == 'left':
        x = 10
    else:  # right
        x = canvas_width - text_width - 10

    return (x, y)
```

---

### 3.4 字体资源

**字体文件存储**:
```
fonts/
├── SourceHanSans-Bold.otf       # 思源黑体
├── Arial-Bold.ttf               # Arial 粗体
├── Impact.ttf                   # Impact
├── ComicSansMS-Bold.ttf         # Comic Sans
├── CourierNew-Bold.ttf          # Courier New
└── NotoSerif-Regular.ttf        # Noto Serif
```

**字体许可**:
- 确保所有字体为开源或已获得商业授权
- 推荐使用 Google Fonts 或 Adobe Open Source

---

## 四、界面设计规范

### 4.1 整体布局

**推荐布局**（桌面版）:
```
┌──────────────────────────────────────────────┐
│ 🎨 Emoji Generator          [简体中文 ▼] │
├────────────┬─────────────────────────────────┤
│            │                                 │
│  参数设置   │         实时预览                │
│            │   ┌─────────────────────┐      │
│ 文字输入   │   │                     │      │
│ 字体选择   │   │      你的文字        │      │
│ 对齐方式   │   │    Custom Emoji     │      │
│ 文字大小   │   │                     │      │
│ 前景色     │   └─────────────────────┘      │
│ 背景色     │                                 │
│            │   [生成并下载 PNG]  [重置]      │
│ [预设方案] │                                 │
│            │                                 │
└────────────┴─────────────────────────────────┘
```

**响应式布局**（移动版）:
```
┌──────────────────────────┐
│ 🎨 Emoji Generator      │
├──────────────────────────┤
│      实时预览             │
│  ┌────────────────────┐  │
│  │                    │  │
│  │     你的文字        │  │
│  │                    │  │
│  └────────────────────┘  │
│                          │
│  [生成并下载]  [重置]    │
├──────────────────────────┤
│  ⚙️ 参数设置             │
│  [展开/收起]             │
├──────────────────────────┤
│  📝 第一行: [______]     │
│  📝 第二行: [______]     │
│  🔤 字体: [下拉菜单]      │
│  ... (其他参数)          │
└──────────────────────────┘
```

---

### 4.2 配色方案

**主色调**:
- 主色：蓝色 (#3B88C3)
- 辅助色：灰色 (#6C757D)
- 成功色：绿色 (#28A745)
- 警告色：黄色 (#FFC107)
- 错误色：红色 (#DC3545)

**背景色**:
- 页面背景：浅灰 (#F8F9FA)
- 卡片背景：白色 (#FFFFFF)
- 输入框背景：白色 (#FFFFFF)

---

### 4.3 字体规范

**网页字体**:
```css
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
               "Roboto", "Helvetica Neue", Arial, sans-serif;
}

h1 { font-size: 24px; font-weight: 700; }
h2 { font-size: 18px; font-weight: 600; }
body { font-size: 14px; line-height: 1.5; }
```

---

## 五、非功能需求

### 5.1 性能要求

| 指标 | 目标 |
|------|------|
| 首屏加载时间 | < 2 秒 |
| 预览更新延迟 | < 100ms |
| 图片生成时间 | < 1 秒 |
| 并发处理能力 | 100 请求/秒 |

---

### 5.2 兼容性要求

**浏览器支持**:
- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+
- ❌ IE 11（不支持）

**设备支持**:
- ✅ 桌面电脑（1920x1080 及以上）
- ✅ 平板电脑（768px - 1024px）
- ✅ 手机（375px - 768px）

---

### 5.3 安全性要求

1. **输入验证**:
   - 限制文字长度防止滥用
   - 过滤恶意字符（如 SQL 注入）
   - 限制文件生成频率（防止 DDoS）

2. **API 限流**:
   - 单 IP 每分钟最多 60 次请求
   - 超限返回 429 Too Many Requests

3. **XSS 防护**:
   - 转义用户输入
   - 设置 Content-Security-Policy

---

### 5.4 可维护性要求

1. **代码规范**:
   - 遵循 PEP 8（Python）
   - 遵循 ESLint（JavaScript）
   - 代码注释覆盖率 > 30%

2. **日志记录**:
   - 记录所有 API 请求
   - 记录生成失败的错误
   - 日志保留 30 天

3. **监控告警**:
   - 服务器 CPU/内存监控
   - API 响应时间监控
   - 错误率超过 5% 时告警

---

## 六、开发计划

### 6.1 版本规划

**v1.0（MVP）- 预计 2 周**
- ✅ 基础文字输入（1-2 行）
- ✅ 6 种字体选择
- ✅ 颜色自定义（前景色 + 背景色）
- ✅ 透明背景支持
- ✅ 实时预览
- ✅ PNG 下载

**v1.1 - 预计 1 周**
- ✅ 预设配色方案
- ✅ 参数导入导出
- ✅ 使用指南

**v2.0 - 预计 3 周**
- ✅ 更多字体（15+ 种）
- ✅ 文字描边效果
- ✅ 渐变背景
- ✅ 多尺寸导出（64px, 128px, 256px）
- ✅ 批量生成

**v3.0（未来规划）**
- 🎬 GIF 动画表情
- 🤖 AI 推荐配色
- 📦 个人表情库
- 🌐 多语言支持（英文、日文）

---

### 6.2 里程碑

| 里程碑 | 日期 | 交付物 |
|--------|------|--------|
| 需求评审完成 | Week 1 | PRD v1.0 |
| UI 设计完成 | Week 2 | 设计稿 + 交互原型 |
| 前端开发完成 | Week 3 | 静态页面 + 交互逻辑 |
| 后端开发完成 | Week 4 | API + 图片生成 |
| 测试与优化 | Week 5 | 测试报告 |
| 上线部署 | Week 6 | 生产环境 |

---

## 七、验收标准

### 7.1 功能验收

- [ ] 能输入 1-2 行中英文文字
- [ ] 能选择至少 6 种字体
- [ ] 能自定义前景色和背景色（HEX/RGB）
- [ ] 能设置透明背景
- [ ] 实时预览与最终生成一致
- [ ] 生成 128x128px 的 PNG 文件
- [ ] 下载文件名包含文字内容和时间戳
- [ ] 桌面和移动端均可正常使用

### 7.2 性能验收

- [ ] 首屏加载 < 2 秒
- [ ] 预览更新延迟 < 100ms
- [ ] 图片生成 < 1 秒
- [ ] 支持 Chrome/Firefox/Safari 最新版本

### 7.3 体验验收

- [ ] 新用户无需指导即可完成生成
- [ ] 错误提示清晰友好
- [ ] 移动端操作流畅

---

## 八、风险与挑战

### 8.1 技术风险

| 风险 | 影响 | 应对措施 |
|------|------|----------|
| 字体渲染兼容性问题 | 高 | 提前测试多种字体库，准备备选方案 |
| 中文字体文件过大 | 中 | 使用字体子集化技术，仅包含常用字 |
| 服务器负载过高 | 中 | 使用 CDN 缓存，限流策略 |

### 8.2 产品风险

| 风险 | 影响 | 应对措施 |
|------|------|----------|
| 用户需求与预期不符 | 高 | 尽早发布 Beta 版收集反馈 |
| 竞品推出类似功能 | 中 | 快速迭代，强化差异化特性 |

---

## 九、参考资料

- emoji-gen.ninja 官网: https://emoji-gen.ninja/
- Slack Emoji Guidelines
- Discord Custom Emoji Requirements
- Skia Graphics Library 文档
- Pillow (PIL) 官方文档

---

## 十、附录

### 10.1 术语表

| 术语 | 说明 |
|------|------|
| Reacji | Reaction Emoji，反应表情 |
| HEX | 十六进制颜色代码，如 #FFFFFF |
| RGB | 红绿蓝三原色模型 |
| Alpha | 透明度通道 |
| PNG | 便携式网络图形格式，支持透明 |

### 10.2 FAQ

**Q1: 为什么生成的图片是 128x128 而不是更大？**
A: 这是 Slack/Discord 等平台推荐的表情尺寸，既保证清晰度又节省存储空间。

**Q2: 能否支持 GIF 动画？**
A: v1.0 暂不支持，计划在 v3.0 中实现。

**Q3: 字体版权如何处理？**
A: 所有内置字体均为开源字体或已获授权的免费字体。

---

**文档状态**: ✅ 已完成
**下一步**: 启动 UI 设计和技术预研
